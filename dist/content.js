(()=>{"use strict";var e={144:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))((function(n,l){function s(e){try{r(o.next(e))}catch(e){l(e)}}function a(e){try{r(o.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}r((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=i(473);function l(e){return o(this,void 0,void 0,(function*(){if((0,n.log)("iFrame",n.Level.INFO,"Checking iFrame contentWindow..."),null!=e.contentWindow){(0,n.log)("iFrame",n.Level.INFO,"Successfully get iFrame document."),(0,n.log)("iFrame",n.Level.INFO,"Finding VideoPlayer (#video-player)");const t=e.contentWindow.document.getElementById("video-player");null!=t?((0,n.log)("VideoPlayer",n.Level.INFO,"Successfully found video! "+t),(0,n.log)("VideoPlayer",n.Level.INFO,'Registering "ended" event to target video!'),t.addEventListener("ended",m),(0,n.log)("VideoPlayer",n.Level.INFO,'Successfully registered "ended" event to target video!'),(0,n.log)("VideoPlayer",n.Level.INFO,'Registering "pause" event to target video!'),t.addEventListener("pause",(e=>o(this,void 0,void 0,(function*(){(yield y()).useAutoPauseUnblock&&t.currentTime!=t.duration&&((0,n.log)("VideoPlayer",n.Level.INFO,"\nDamn, that trashy high school just paused the video!\nI'll never forgive you! I'm gonna resume playback!\nLMAO."),e.preventDefault(),e.stopImmediatePropagation(),yield t.play())})))),(0,n.log)("VideoPlayer",n.Level.INFO,'Successfully registered "pause" event to target video!'),(yield y()).useSeekUnblock&&((0,n.log)("VideoPlayer",n.Level.INFO,'Registering "seeking" event to target video!'),t.addEventListener("seeking",f),(0,n.log)("VideoPlayer",n.Level.INFO,'Successfully registered "seeking" event to target video!'),(0,n.log)("VideoPlayer",n.Level.INFO,'Registering "seeked" event to target video!'),t.addEventListener("seeked",f),(0,n.log)("VideoPlayer",n.Level.INFO,'Successfully registered "seeked" event to target video!'))):(0,n.log)("VideoPlayer",n.Level.ERROR,"Failed to find video!")}else(0,n.log)("iFrame",n.Level.ERROR,"Failed to get iFrame document!")}))}function s(e,t){if(e.useDiscordNotification&&e.discordWebhookUrl.length>0&&e.discordWebhookUrl.startsWith("https://discord.com/api/webhooks/")){(0,n.log)("Notify/Discord",n.Level.INFO,"Sending notification to discord.");const i=new XMLHttpRequest;i.open("POST",e.discordWebhookUrl),i.setRequestHeader("Content-Type","application/json"),i.addEventListener("readystatechange",(e=>{4==i.readyState&&(204==i.status?(0,n.log)("Notify/Discord",n.Level.INFO,"Successfully sent notification to discord."):400==i.status&&((0,n.log)("Notify/Discord",n.Level.WARN,"Failed to sent notification to discord."),(0,n.log)("Notify/Discord",n.Level.WARN,i.responseText)))})),t=t.replace("%mention%",e.discordMention),i.send(JSON.stringify({username:"N予備校",avatar_url:"https://www.ryuuta0217.com/nnn.ed.nico.png",content:t}))}}function a(e,t,i){if(e.useDesktopNotification){const e=new Notification(t,{body:i,icon:"https://www.nnn.ed.nico/favicon.ico"});setTimeout(e.close.bind(e),3e3)}}function r(){const e=document.querySelectorAll("div.l-contents#sections-contents>div.section>div.u-card>ul.u-list>li"),t=[];return e.forEach(((e,i)=>{const o=e.className,n=e.getElementsByTagName("a");let l=-1;if(o.includes("movie")){const t=e.querySelector("a>div.section-optional-info>p.content-amount.movie-length").innerText.split(":");2==t.length?l=60*Number(t[0])+Number(t[1]):3==t.length&&(l=60*Number(t[0])*60+60*Number(t[1])+Number(t[2]))}t[i]={title:e.querySelector("a>div.section-main-info>div>p>span.title").innerText,isGood:o.includes("good"),isMovie:o.includes("movie"),isSupplement:o.includes("supplement"),isEvaluationTest:o.includes("evaluation-test"),isEssayTest:o.includes("essay-test"),isOpened:n.length>0&&n[0].className.includes("is-selected"),isGateClosed:n.length>0&&n[0].className.includes("is-gate-closed"),movieTimeSeconds:l,element:e,clickTarget:n.length>0?n[0]:null}})),t}function d(){const e=r().filter((e=>e.isOpened));return e.length>0?e[0]:null}function c(e){const t=r().filter((t=>(t.isMovie||t.isEvaluationTest||t.isEssayTest)&&(e?t.isSupplement:!t.isSupplement))),i=t.findIndex(((e,t,i)=>e.isOpened))+1;if(i<=t.length-1){const e=t[i];if(e.isMovie)return e}return null}function u(){return o(this,void 0,void 0,(function*(){const e=c(!1);return null!=e&&((0,n.log)("Automation",n.Level.INFO,"Clicking next chapter..."),g(e.clickTarget),(0,n.log)("Automation",n.Level.INFO,"Sending playback started notification"),yield function(e){return o(this,void 0,void 0,(function*(){if(null!=e&&e.isMovie){const t=yield y();t.notifyVideoStateChange&&((0,n.log)("Notify",n.Level.INFO,"Notifying video playback started."),s(t,t.discordPlaybackStartedMessage.replace("%title%",e.title)),a(t,t.desktopPlaybackStarted,e.title),(0,n.log)("Notify",n.Level.INFO,"Successfully sent video playback started notify."))}}))}(e),!0)}))}function v(){return o(this,void 0,void 0,(function*(){const e=function(){const e=r().filter((e=>(e.isEssayTest||e.isEvaluationTest)&&!e.isGateClosed&&!e.isGood&&!e.isOpened));return e.length>0?e[0]:null}();return null!=e&&(g(e.clickTarget),yield function(e){return o(this,void 0,void 0,(function*(){if(null!=e&&(e.isEssayTest||e.isEvaluationTest)){const t=yield y();s(t,t.discordTakeTestMessage.replace("%title%",e.title)),a(t,t.desktopTakeTest,e.title)}}))}(e),!0)}))}function g(e){const t=document.createEvent("MouseEvent");t.initEvent("click",!0,!0),e.dispatchEvent(t)}function m(e){return o(this,void 0,void 0,(function*(){(0,n.log)("VideoPlayer",n.Level.INFO,"Playback ended, sending notification..."),yield function(e){return o(this,void 0,void 0,(function*(){if(null!=e&&e.isMovie){const t=yield y();t.notifyVideoStateChange&&((0,n.log)("Notify",n.Level.INFO,"Notifying video playback ended"),s(t,t.discordPlaybackEndedMessage.replace("%title%",e.title)),a(t,t.desktopPlaybackEnded,e.title),(0,n.log)("Notify",n.Level.INFO,"Successfully sent video playback ended notify."))}}))}(d()),(0,n.log)("VideoPlayer",n.Level.INFO,"Successfully sent notification!");const e=yield y();if(e.useAutoNext){(0,n.log)("Automation",n.Level.INFO,"useAutoNext is active, finding next chapter...");const t=function(e,t){(0,n.log)("Chapter",n.Level.INFO,"Finding next required chapter...");const i=r().filter((t=>(t.isMovie||t.isEvaluationTest||t.isEssayTest)&&(e?t.isSupplement:!t.isSupplement)));(0,n.log)("Chapter",n.Level.INFO,"Got "+i.length+" chapters.");const o=i.findIndex(((e,t,i)=>e.isOpened));(0,n.log)("Chapter",n.Level.INFO,"Currently opened chapter index is "+o);let l=o+1;if((0,n.log)("Chapter",n.Level.INFO,"Next chapter index is "+l),l<i.length){let e=i[l];if((0,n.log)("Chapter",n.Level.INFO,"Next chapter found: "+e.title),t&&e.isGood){for((0,n.log)("Chapter",n.Level.INFO,"Flag notGoodOnly is active. Next chapter is Good, search Chapter that is not Good.");null!=e&&e.isGood;)l+=1,e=l<i.length?i[l]:null;(0,n.log)("Chapter",n.Level.INFO,"Search ended, chapter: "+(null!=e?e.title:"null"))}if(null!=e)return(0,n.log)("Chapter",n.Level.INFO,"Found chapter: "+e.title),e}return null}(e.useAutoNextContainsSupplements,e.useAutoNextNotGoodOnly);if(null!=t)if((0,n.log)("Automation",n.Level.INFO,"Chapter found: "+t.title),t.isGateClosed){let e;(0,n.log)("Automation",n.Level.INFO,"Gate is closed, use MutationObserver to observe changes...");const i=()=>o(this,void 0,void 0,(function*(){(0,n.log)("Automation/Observer",n.Level.INFO,"Attributes changed, clicking."),t.isMovie?yield u():(t.isEssayTest||t.isEvaluationTest)&&(yield v()),e.disconnect()}));e=new MutationObserver(i),e.observe(t.element.querySelector("a"),{attributes:!0})}else(0,n.log)("Automation",n.Level.INFO,"Gate is already opened, clicking."),t.isMovie?yield u():(t.isEssayTest||t.isEvaluationTest)&&(yield v())}}))}function f(e){(0,n.log)("VideoPlayer",n.Level.INFO,"Video seeking detected, cancelling this."),e.preventDefault(),e.stopImmediatePropagation()}function y(){return o(this,void 0,void 0,(function*(){return yield chrome.storage.sync.get()}))}function p(e){let t=[0,0,0];return t[0]=Math.floor(e/3600),t[1]=Math.floor(e%3600/60),t[2]=e%60,t}function N(e,t){return("0".repeat(t)+e).slice(-t)}"denied"!=window.Notification.permission&&"default"!=window.Notification.permission||window.Notification.requestPermission().then((()=>{"granted"==window.Notification.permission?(0,n.log)("Permission",n.Level.INFO,"Desktop Notification Permission is now accepted."):(0,n.log)("Permission",n.Level.WARN,"Desktop Notification Permission is not accepted, desktop notifications will be not sent to you.")})),document.getElementById("modal-inner-iframe")instanceof HTMLIFrameElement||(new MutationObserver((()=>{(0,n.log)("MutationObserver",n.Level.INFO,"DOM change detected, registering 'load' event to iFrame (#modal-inner-iframe)!");const e=document.getElementById("modal-inner-iframe");null!=e?(e.addEventListener("load",(t=>{if((0,n.log)("iFrame",n.Level.INFO,"iFrame loaded."),(0,n.log)("iFrame",n.Level.INFO,"Checking iFrame contentWindow..."),null!=e.contentWindow){(0,n.log)("iFrame",n.Level.INFO,"iFrame contentWindow found!");const t=d();if(null==t)return;if(t.isEssayTest||t.isEvaluationTest||!t.isMovie)(0,n.log)("iFrame",n.Level.INFO,"Opened iFrame is Essay or Evaluation test, skipping.");else if((0,n.log)("iFrame",n.Level.INFO,"Finding VideoPlayer..."),e.contentWindow.document.getElementById("video-player")instanceof HTMLMediaElement)(0,n.log)("iFrame",n.Level.INFO,"VideoPlayer already loaded, use this."),l(e).then((()=>(0,n.log)("iFrame",n.Level.INFO,"Successfully registered video events.")));else{(0,n.log)("iFrame",n.Level.INFO,"VideoPlayer not loaded, use setInterval to try find...");const t=setInterval((()=>{null!=e.contentWindow&&null!=e.contentWindow.document.getElementById("video-player")&&((0,n.log)("iFrame/Timer",n.Level.INFO,"VideoPlayer loaded!"),clearInterval(t),l(e).then((()=>(0,n.log)("iFrame",n.Level.INFO,"Successfully registered video events."))))}),10)}}})),(0,n.log)("MutationObserver",n.Level.INFO,"Successfully registered 'load' event to iFrame (#modal-inner-iframe)")):(0,n.log)("MutationObserver",n.Level.ERROR,"Failed to find iFrame (#modal-inner-iframe)! Event is not registered.")})).observe(document.querySelector('div[data-react-class="App.Modal"]'),{childList:!0}),y().then((e=>{e.startPlaybackWhenOpenPage&&(null!=c(!1)?u().then((e=>{e&&(0,n.log)("main",n.Level.INFO,"Auto playback starting.")})):(0,n.log)("main",n.Level.WARN,"Failed to auto playback."))})));const h=r(),F=h.filter((e=>e.isMovie)),I=F.filter((e=>e.isGood)),L=F.filter((e=>!e.isSupplement)),O=I.filter((e=>!e.isSupplement)),E=F.filter((e=>e.isSupplement)),S=I.filter((e=>e.isSupplement)),b=h.filter((e=>e.isEssayTest||e.isEvaluationTest)),R=b.filter((e=>e.isGood));let T=0,k=0,A=0;L.forEach((e=>{T+=e.movieTimeSeconds,e.isGood?k+=e.movieTimeSeconds:A+=e.movieTimeSeconds}));let P=0,C=0,w=0;E.forEach((e=>{P+=e.movieTimeSeconds,e.isGood?w+=e.movieTimeSeconds:C+=e.movieTimeSeconds}));const M=p(T),D=p(k),W=p(A),x=p(P),G=p(w),V=p(C);let _=document.getElementsByClassName("description");void 0===_&&location.reload(),_[0].innerHTML="<div class='u-card'><div class='u-list-header typo-list-title'>この単元の進捗状況</div><div class='u-card-inner'>[必修教材]<br>視聴済み動画本数: "+O.length+"/"+L.length+"本<br>受講済みテスト数: "+R.length+"/"+b.length+"個<br>合計動画時間: "+(M[0]>0?N(M[0],2)+"時間":"")+N(M[1],2)+"分"+N(M[2],2)+"秒<br>視聴済み動画時間: "+(D[0]>0?N(D[0],2)+"時間":"")+N(D[1],2)+"分"+N(D[2],2)+"秒<br>未試聴動画時間: "+(W[0]>0?N(W[0],2)+"時間":"")+N(W[1],2)+"分"+N(W[2],2)+"秒<br><br>[Nプラス教材]<br>視聴済み動画本数: "+S.length+"/"+E.length+"本<br>合計動画時間: "+(x[0]>0?N(x[0],2)+"時間":"")+N(x[1],2)+"分"+N(x[2],2)+"秒<br>視聴済み動画時間: "+(G[0]>0?N(G[0],2)+"時間":"")+N(G[1],2)+"分"+N(G[2],2)+"秒<br>未試聴動画時間: "+(V[0]>0?N(V[0],2)+"時間":"")+N(V[1],2)+"分"+N(V[2],2)+"秒<br></div></div>"+_[0].innerHTML},473:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.log=t.ASCIIColor=t.Level=void 0,t.Level={INFO:"INFO",WARN:"WARN",ERROR:"ERROR",DEBUG:"DEBUG"},t.ASCIIColor={BLACK:"[30m",GRAY:"[90m",DARK_RED:"[31m",RED:"[91m",DARK_GREEN:"[32m",GREEN:"[92m",DARK_YELLOW:"[33m",YELLOW:"[93m",DARK_BLUE:"[34m",BLUE:"[94m",DARK_PURPLE:"[35m",PURPLE:"[95m",DARK_AQUA:"[36m",AQUA:"[96m",DARK_WHITE:"[37m",WHITE:"[97m",RESET:"[0m"},t.log=function(e,i,o){let n=i==t.Level.INFO?t.ASCIIColor.WHITE:i==t.Level.WARN?t.ASCIIColor.DARK_YELLOW:i==t.Level.ERROR?t.ASCIIColor.DARK_RED:t.ASCIIColor.GRAY;console.log(n+"["+new Intl.DateTimeFormat("ja-JP",{timeStyle:"medium"}).format(new Date)+"] ["+e+"] ["+i+"] "+o+t.ASCIIColor.RESET)}}},t={};!function i(o){var n=t[o];if(void 0!==n)return n.exports;var l=t[o]={exports:{}};return e[o].call(l.exports,l,l.exports,i),l.exports}(144)})();