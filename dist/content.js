(()=>{"use strict";var e={913:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function l(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.initialize=t.getConfig=t.setDefault=t.CONFIG_VERSION=void 0;const i=n(473);t.CONFIG_VERSION=2;const s={version:t.CONFIG_VERSION,useDesktopNotification:!0,useDiscordNotification:!1,discordWebhookUrl:"",discordMention:"",autoOpenChapterWhenOpenPage:!1,useAutoNext:!0,useAutoNextContainsSupplements:!1,useAutoNextNotGoodOnly:!0,useAutoPauseUnblock:!0,useSeekUnblock:!0,notifyVideoStateChange:!1,discordPlaybackStartedMessage:"%mention% 教材動画 `%title%` の再生を開始しました",discordPlaybackEndedMessage:"%mention% 教材動画 `%title%` の再生が終了しました",discordTakeTestMessage:"%mention% テスト `%title%` を受けてください",desktopPlaybackStarted:"教材動画の再生を開始しました",desktopPlaybackEnded:"教材動画の再生が終了しました",desktopTakeTest:"テストを受けてください",unknownVideo:"不明な動画",unknownTest:"不明なテスト"};function l(){return o(this,void 0,void 0,(function*(){yield chrome.storage.sync.clear(),yield chrome.storage.sync.set(s),(0,i.log)("Config",i.Level.INFO,"Configuration initialized.")}))}function a(){return o(this,void 0,void 0,(function*(){if(0==(yield chrome.storage.sync.getBytesInUse()))(0,i.log)("Config",i.Level.INFO,"Configuration not found, writing default configuration."),yield l();else{let e=yield chrome.storage.sync.get();if(!e.version){(0,i.log)("Config",i.Level.INFO,"Configuration migrate required. You're using config version 1.");const t={version:2,useDesktopNotification:e.useDesktopNotification,useDiscordNotification:e.useDiscordNotification,discordWebhookUrl:e.discordWebhookUrl,discordMention:e.discordMention,autoOpenChapterWhenOpenPage:e.startPlaybackWhenOpenPage,useAutoNext:e.useAutoNext,useAutoNextContainsSupplements:e.useAutoNextContainsSupplements,useAutoNextNotGoodOnly:e.useAutoNextNotGoodOnly,useAutoPauseUnblock:e.useAutoPauseUnblock,useSeekUnblock:e.useSeekUnblock,notifyVideoStateChange:e.notifyVideoStateChange,discordPlaybackStartedMessage:e.discordPlaybackStartedMessage,discordPlaybackEndedMessage:e.discordPlaybackEndedMessage,discordTakeTestMessage:e.discordTakeTestMessage,desktopPlaybackStarted:e.desktopPlaybackStarted,desktopPlaybackEnded:e.desktopPlaybackEnded,desktopTakeTest:e.desktopTakeTest,unknownVideo:e.unknownVideo,unknownTest:e.unknownTest};yield chrome.storage.sync.clear(),yield chrome.storage.sync.set(t)}if(e.version!=s.version){if(2==e.version){let t={version:3,useDesktopNotification:e.useDesktopNotification,useDiscordNotification:e.useDiscordNotification,discordWebhookUrl:e.discordWebhookUrl,discordMention:e.discordMention,autoOpenChapterWhenOpenPage:e.autoOpenChapterWhenOpenPage,useAutoNext:e.useAutoNext,useAutoNextContainsSupplements:e.useAutoNextContainsSupplements,useAutoNextNotGoodOnly:e.useAutoNextNotGoodOnly,useAutoPauseUnblock:e.useAutoPauseUnblock,useSeekUnblock:e.useSeekUnblock,notifyVideoStateChange:e.notifyVideoStateChange,discordPlaybackStartedMessage:e.discordPlaybackStartedMessage,discordPlaybackEndedMessage:e.discordPlaybackEndedMessage,discordTakeTestMessage:e.discordTakeTestMessage,desktopPlaybackStarted:e.desktopPlaybackStarted,desktopPlaybackEnded:e.desktopPlaybackEnded,desktopTakeTest:e.desktopTakeTest,unknownVideo:e.unknownVideo,unknownTest:e.unknownTest};yield chrome.storage.sync.clear(),yield chrome.storage.sync.set(t),e=yield chrome.storage.sync.get()}e.version}}}))}t.setDefault=l,t.getConfig=function(){return o(this,void 0,void 0,(function*(){return yield a(),yield chrome.storage.sync.get()}))},t.initialize=a},144:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function l(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(647),s=n(473),l=n(913),a=n(931),c=n(268),r=n(593),d=n(242),u=new a.EventManager;function g(e){return o(this,void 0,void 0,(function*(){if((0,s.log)("iFrame",s.Level.INFO,"Checking iFrame contentWindow..."),null!=e.contentWindow){(0,s.log)("iFrame",s.Level.INFO,"Successfully get iFrame document."),(0,s.log)("iFrame",s.Level.INFO,"Finding VideoPlayer (#video-player)");const t=e.contentWindow.document.getElementById("video-player");if(null!=t){if((0,s.log)("VideoPlayer",s.Level.INFO,"Successfully found video! "+t),t.paused){(0,s.log)("VideoPlayer",s.Level.INFO,'Registering "play" event to target video!');const e=n=>{(0,s.log)("VideoPlayer",s.Level.INFO,"Playback started, sending notification..."),(0,c.sendNotifyPlaybackStarted)(y()).then((()=>(0,s.log)("VideoPlayer",s.Level.INFO,"Successfully sent notification!"))),t.removeEventListener("play",e)};t.addEventListener("play",e),(0,s.log)("VideoPlayer",s.Level.INFO,'Successfully registered "play" event to target video!')}else(0,s.log)("VideoPlayer",s.Level.INFO,"Video is already playing, sending notification..."),(0,c.sendNotifyPlaybackStarted)(y()).then((()=>(0,s.log)("VideoPlayer",s.Level.INFO,"Successfully sent notification!")));(0,s.log)("VideoPlayer",s.Level.INFO,'Registering "ended" event to target video!'),t.addEventListener("ended",(()=>o(this,void 0,void 0,(function*(){(0,s.log)("VideoPlayer",s.Level.INFO,"Playback ended, sending notification..."),yield(0,c.sendNotifyPlaybackEnded)(y()),(0,s.log)("VideoPlayer",s.Level.INFO,"Successfully sent notification!")})))),(0,s.log)("VideoPlayer",s.Level.INFO,'Successfully registered "ended" event to target video!')}else(0,s.log)("VideoPlayer",s.Level.ERROR,"Failed to find video!")}else(0,s.log)("iFrame",s.Level.ERROR,"Failed to get iFrame document!")}))}let v=null;function p(){if(console.log(v),null!=v&&v.length>0)return v;(0,s.log)("getSections",s.Level.INFO,"Retrieving sections...");const e=document.querySelectorAll("main>div>div>div>ul.sc-aXZVg.sc-gEvEer.sc-l5r9s4-0.dKubqp.fteAEG.bKupGM>li"),t=[];return e.forEach(((e,n)=>{e.setAttribute("n-cheat-id",String(n));const o=e.querySelector("div[class^=sc-][class^=sc-][class*=sc-][class^=sc-] > div[class^=sc-][class^=sc-][class^=sc-]"),l=o.querySelector("span[class^=sc-]:nth-child(2)").innerText;let a=null;const c=e.querySelector("i");if(null!=c){const t=c.getAttribute("type");null!=t&&("movie-rounded"==t&&(a=i.SectionType.MOVIE),"movie-rounded-plus"==t&&(a=i.SectionType.SUPPLEMENT),"exercise-rounded"==t)&&null!=e.querySelector("span[class^=sc-]:nth-child(2)")&&(l.includes("記述/選択テスト")||l.includes("選択記述式")?a=i.SectionType.EVALUATION_TEST:l.includes("論述テスト")?a=i.SectionType.ESSAY_TEST:l.includes("選択/記述式レポート")||l.includes("記述/選択レポート")?a=i.SectionType.EVALUATION_REPORT:l.includes("論述式レポート")?a=i.SectionType.ESSAY_REPORT:(0,s.log)("getSections",s.Level.ERROR,"Unknown exercise type detected: "+l))}e.setAttribute("n-cheat-type",String(a));const r=f(e,!1);if(null==r)return;let d=-1;if(a==i.SectionType.MOVIE||a==i.SectionType.SUPPLEMENT){const e=o.querySelector("div[class^=sc-][class$=iuHQbN]").innerText.split(":");2==e.length?d=60*Number(e[0])+Number(e[1]):3==e.length&&(d=60*Number(e[0])*60+60*Number(e[1])+Number(e[2]))}t[n]={title:l,type:a,isGood:r.isGood,isMovie:a==i.SectionType.MOVIE||a==i.SectionType.SUPPLEMENT,isSupplement:a==i.SectionType.SUPPLEMENT,isEvaluationTest:a==i.SectionType.EVALUATION_TEST,isEssayTest:a==i.SectionType.ESSAY_TEST,isEvaluationReport:a==i.SectionType.EVALUATION_REPORT,isEssayReport:a==i.SectionType.ESSAY_REPORT,isOpened:r.isOpened,isGateClosed:r.isGateClosed,movieTimeSeconds:d,element:e,clickTarget:e.querySelector("div"),apiData:null}})),fetch(location.href.replace("www.nnn.ed.nico/","api.nnn.ed.nico/v2/material/"),{method:"GET",credentials:"include"}).then((e=>e.json())).then((n=>{t.forEach(((e,t)=>{null!=n.chapter.sections[t]&&n.chapter.sections[t].title==e.title?e.apiData=n.chapter.sections[t]:(0,s.log)("getSections",s.Level.ERROR,"Failed to get API data for section "+e.title)})),u.dispatchEvent(new d.TenjinDataFetchedEvent(e[0].parentElement,n))})).catch((e=>(0,s.log)("getSections",s.Level.ERROR,"Failed to fetch Tenjin API data: "+e))),e.forEach((e=>{const t=e.querySelector("div");null!=t&&new MutationObserver(((e,t)=>{e.forEach((e=>{e.target instanceof HTMLDivElement&&f(e.target.parentElement)}))})).observe(t,{attributes:!0})})),u.addEventListener(d.ChapterGateOpenEvent.TYPE,(e=>o(this,void 0,void 0,(function*(){(0,s.log)("GateOpenEvent",s.Level.INFO,"Gate opened! Checking config...");const t=e.getData();(yield(0,l.getConfig)()).useAutoNext&&((0,s.log)("GateOpenEvent",s.Level.INFO,"useAutoNext is active, opening next chapter..."),yield function(e){return o(this,void 0,void 0,(function*(){return null!=e&&(e.isMovie?yield function(e){return o(this,void 0,void 0,(function*(){return null!=e&&((0,s.log)("Automation/playVideo",s.Level.INFO,"Clicking next section..."),(0,r.click)(e.clickTarget),(0,s.log)("Automation",s.Level.INFO,"Sending playback started notification"),!0)}))}(e):yield function(e){return o(this,void 0,void 0,(function*(){return null!=e&&!e.isMovie&&((0,s.log)("Automation/openTest",s.Level.INFO,"Clicking next section..."),(0,r.click)(e.clickTarget),(0,s.log)("Automation/openTest",s.Level.INFO,"Sending take test notification"),yield(0,c.sendNotifyTakeTest)(e),!0)}))}(e))}))}(t))})))),(0,s.log)("getSections",s.Level.INFO,"Successfully retrieved sections."),v=t,t}function f(e,t=!0){if(null==e)return null;const n=e.querySelector("i"),o=e.hasAttribute("n-cheat-id")&&v&&v[Number(e.getAttribute("n-cheat-id"))]?{isGood:v[Number(e.getAttribute("n-cheat-id"))].isGood,isOpened:v[Number(e.getAttribute("n-cheat-id"))].isOpened,isGateClosed:v[Number(e.getAttribute("n-cheat-id"))].isGateClosed}:null,i={isGood:null!=n&&"rgb(0, 197, 65)"==n.style.color,isOpened:null!=e.querySelector("div[class$=crtNbk]")&&null==e.querySelector("div[class$=cpELFc]"),isGateClosed:null!=e.querySelector("div[class$=hoWVG]")};if(e.setAttribute("n-cheat-good",String(i.isGood)),e.setAttribute("n-cheat-opened",String(i.isOpened)),e.setAttribute("n-cheat-gate-closed",String(i.isGateClosed)),t){if(null==v)return p(),f(e,t);{const t=v[Number(e.getAttribute("n-cheat-id"))];t.isGood=i.isGood,t.isOpened=i.isOpened,t.isGateClosed=i.isGateClosed}}return null!=v&&null!=o&&(!o.isGood&&i.isGood&&u.dispatchEvent(new d.ChapterGoodEvent(e,v[Number(e.getAttribute("n-cheat-id"))])),o.isGateClosed&&!i.isGateClosed&&u.dispatchEvent(new d.ChapterGateOpenEvent(e,v[Number(e.getAttribute("n-cheat-id"))]))),i}function y(){if(null!=v){const e=document.querySelector("li[n-cheat-opened=true]");if(null!=e){const t=e.getAttribute("n-cheat-id");if(null!=t){const e=Number(t);return v[e]}}}const e=p().filter((e=>e.isOpened));return e.length>0?e[0]:null}"denied"!=window.Notification.permission&&"default"!=window.Notification.permission||window.Notification.requestPermission().then((()=>{"granted"==window.Notification.permission?(0,s.log)("Permission",s.Level.INFO,"Desktop Notification Permission is now accepted."):(0,s.log)("Permission",s.Level.WARN,"Desktop Notification Permission is not accepted, desktop notifications will be not sent to you.")})),new MutationObserver(((e,t)=>{const n=document.querySelector('div[class="ReactModalPortal"]');null!=n?(function(){const e=p().filter((e=>e.isMovie)),t=e.filter((e=>e.isGood)),n=e.filter((e=>!e.isSupplement)),o=t.filter((e=>!e.isSupplement)),i=e.filter((e=>e.isSupplement)),s=t.filter((e=>e.isSupplement)),l=p().filter((e=>e.isEssayTest||e.isEvaluationTest||e.isEssayReport||e.isEvaluationReport)),a=l.filter((e=>e.isGood));let c=0,d=0,u=0;n.forEach((e=>{c+=e.movieTimeSeconds,e.isGood?d+=e.movieTimeSeconds:u+=e.movieTimeSeconds}));let g=0,v=0,f=0;i.forEach((e=>{g+=e.movieTimeSeconds,e.isGood?f+=e.movieTimeSeconds:v+=e.movieTimeSeconds}));const y=(0,r.getTime)(c),h=(0,r.getTime)(d),N=(0,r.getTime)(u),E=(0,r.getTime)(g),m=(0,r.getTime)(f),O=(0,r.getTime)(v);let S=document.querySelector("main > div[class^=sc-][class^=sc-][class^=sc-] > div[class^=sc-].sc-lcfvsp-4");null==S?location.reload():S.innerHTML=`\n   <div width="100%" class="sc-aXZVg sc-gEvEer eovZuA fteAEG">\n      <div class="sc-aXZVg gPvMWS">この単元の進捗状況</div>\n   </div>\n   <div class="sc-aXZVg sc-gEvEer cMtRut fteAEG sc-oqvosu-0 gNsPPb">\n      <p class="sc-aXZVg hpOOvr">[必修教材]</p>\n      <p class="sc-aXZVg hpOOvr">視聴済み動画本数: ${o.length}/${n.length}本</p>\n      <p class="sc-aXZVg hpOOvr">受講済みテスト数: ${a.length}/${l.length}個</p>\n      <p class="sc-aXZVg hpOOvr">合計動画時間: ${y[0]>0?(0,r.zeroPadding)(y[0],2)+"時間":""}${(0,r.zeroPadding)(y[1],2)}分${(0,r.zeroPadding)(y[2],2)}秒</p>\n      <p class="sc-aXZVg hpOOvr">視聴済み動画時間: ${h[0]>0?(0,r.zeroPadding)(h[0],2)+"時間":""}${(0,r.zeroPadding)(h[1],2)}分${(0,r.zeroPadding)(h[2],2)}秒</p>\n      <p class="sc-aXZVg hpOOvr">未試聴動画時間: ${N[0]>0?(0,r.zeroPadding)(N[0],2)+"時間":""}${(0,r.zeroPadding)(N[1],2)}分${(0,r.zeroPadding)(N[2],2)}秒</p>\n      <br />\n      <p class="sc-aXZVg hpOOvr">[Nプラス教材]</p>\n      <p class="sc-aXZVg hpOOvr">視聴済み動画本数: ${s.length}/${i.length}本</p>\n      <p class="sc-aXZVg hpOOvr">合計動画時間: ${E[0]>0?(0,r.zeroPadding)(E[0],2)+"時間":""}${(0,r.zeroPadding)(E[1],2)}分${(0,r.zeroPadding)(E[2],2)}秒</p>\n      <p class="sc-aXZVg hpOOvr">視聴済み動画時間: ${m[0]>0?(0,r.zeroPadding)(m[0],2)+"時間":""}${(0,r.zeroPadding)(m[1],2)}分${(0,r.zeroPadding)(m[2],2)}秒</p>\n      <p class="sc-aXZVg hpOOvr">未試聴動画時間: ${O[0]>0?(0,r.zeroPadding)(O[0],2)+"時間":""}${(0,r.zeroPadding)(O[1],2)}分${(0,r.zeroPadding)(O[2],2)}秒</p>\n   </div>`+S.innerHTML}(),(0,l.getConfig)().then((e=>{if(e.autoOpenChapterWhenOpenPage){const t=function(e,t){(0,s.log)("getNextSection",s.Level.INFO,"Finding next required section...");let n=p().filter((t=>(t.isMovie||t.isEvaluationTest||t.isEssayTest||t.isEvaluationReport||t.isEssayReport)&&(e?t.isSupplement:!t.isSupplement)));if((0,s.log)("getNextSection",s.Level.INFO,"Found "+n.length+" sections."),n.length>0){const e=n.findIndex(((e,t,n)=>e.isOpened));-1!=e&&((0,s.log)("getNextSection",s.Level.INFO,"Currently section is opened, removing opened and before sections..."),n=n.slice(e+1)),(0,s.log)("getNextSection",s.Level.INFO,"Gathering next section...");let o=n.findIndex(((e,n,o)=>!e.isOpened&&!e.isGateClosed&&(t&&!e.isGood||!t&&e.isGood)));if(-1!=o&&((0,s.log)("getNextSection",s.Level.INFO,"Next section index is "+o),o<n.length)){let e=n[o];if(null!=e)return(0,s.log)("getNextSection",s.Level.INFO,"Found section: "+e.title),e}}return(0,s.log)("getNextSection",s.Level.WARN,"Next section not found, all cleared?"),null}(e.useAutoNextContainsSupplements,e.useAutoNextNotGoodOnly);null!=t&&((0,s.log)("main",s.Level.INFO,"Auto clicking next chapter."),(0,r.click)(t.clickTarget),f(t.element))}})),new MutationObserver((()=>{(0,s.log)("MutationObserver",s.Level.INFO,"DOM change detected, registering 'load' event to iFrame (#modal-inner-iframe)!");const e=document.querySelector('div[class="ReactModalPortal"] iframe');null!=e?(e.addEventListener("load",(t=>{if((0,s.log)("iFrame",s.Level.INFO,"iFrame loaded."),(0,s.log)("iFrame",s.Level.INFO,"Checking iFrame contentWindow..."),null!=e.contentWindow){(0,s.log)("iFrame",s.Level.INFO,"iFrame contentWindow found!");const t=y();if(null==t)return;t.isEssayTest||t.isEvaluationTest||!t.isMovie?(0,s.log)("iFrame",s.Level.INFO,"Opened iFrame is Essay or Evaluation test, skipping."):((0,s.log)("iFrame",s.Level.INFO,"Finding VideoPlayer..."),e.contentWindow.document.getElementById("video-player")instanceof HTMLMediaElement?((0,s.log)("iFrame",s.Level.INFO,"VideoPlayer already loaded, use this."),g(e).then((()=>(0,s.log)("iFrame",s.Level.INFO,"Successfully registered video events.")))):((0,s.log)("iFrame",s.Level.INFO,"VideoPlayer not loaded, use MutationObserver to try find..."),new MutationObserver(((t,n)=>{if(null!=e.contentWindow){const t=e.contentWindow.document.body.querySelector("div#root");null!=(null!=t?t.querySelector("#video-player"):null)&&(g(e).then((()=>(0,s.log)("iFrame",s.Level.INFO,"Successfully registered video events."))),n.disconnect())}})).observe(e.contentWindow.document.body,{attributes:!0,childList:!0,subtree:!0})))}})),(0,s.log)("MutationObserver",s.Level.INFO,"Successfully registered 'load' event to iFrame (#modal-inner-iframe)")):(0,s.log)("MutationObserver",s.Level.ERROR,"Failed to find iFrame (#modal-inner-iframe)! Event is not registered.")})).observe(n,{childList:!0}),t.disconnect()):location.reload()})).observe(document.querySelector("body"),{childList:!0})},931:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function l(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.EventManager=void 0,t.EventManager=class{constructor(){this.listeners={}}addEventListener(e,t){null==this.listeners[e]&&(this.listeners[e]=[]),this.listeners[e].push(t)}removeEventListener(e,t){null!=this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter((e=>e!==t)))}dispatchEvent(e){return n(this,void 0,void 0,(function*(){if(null!=this.listeners[e.getType()])for(const t of this.listeners[e.getType()])yield t(e)}))}}},242:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TenjinDataFetchedEvent=t.ChapterGateOpenEvent=t.ChapterGoodEvent=t.NCheatEvent=void 0;class n{constructor(e,t){this.source=e,this.data=t}getSource(){return this.source}getData(){return this.data}}t.NCheatEvent=n;class o extends n{constructor(e,t){super(e,t)}getType(){return o.TYPE}}t.ChapterGoodEvent=o,o.TYPE="chapter_good";class i extends n{constructor(e,t){super(e,t)}getType(){return i.TYPE}}t.ChapterGateOpenEvent=i,i.TYPE="chapter_gate_open";class s extends n{constructor(e,t){super(e,t)}getType(){return s.TYPE}}t.TenjinDataFetchedEvent=s,s.TYPE="tenjin_data_fetched"},473:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.log=t.ASCIIColor=t.Level=void 0,t.Level={INFO:"INFO",WARN:"WARN",ERROR:"ERROR",DEBUG:"DEBUG"},t.ASCIIColor={BLACK:"[30m",GRAY:"[90m",DARK_RED:"[31m",RED:"[91m",DARK_GREEN:"[32m",GREEN:"[92m",DARK_YELLOW:"[33m",YELLOW:"[93m",DARK_BLUE:"[34m",BLUE:"[94m",DARK_PURPLE:"[35m",PURPLE:"[95m",DARK_AQUA:"[36m",AQUA:"[96m",DARK_WHITE:"[37m",WHITE:"[97m",RESET:"[0m"},t.log=function(e,n,o){let i=n==t.Level.INFO?t.ASCIIColor.WHITE:n==t.Level.WARN?t.ASCIIColor.DARK_YELLOW:n==t.Level.ERROR?t.ASCIIColor.DARK_RED:t.ASCIIColor.GRAY;console.log(i+"["+new Intl.DateTimeFormat("ja-JP",{timeStyle:"medium"}).format(new Date)+"] ["+e+"] ["+n+"] "+o+t.ASCIIColor.RESET)}},268:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function l(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.sendNotifyTakeTest=t.sendNotifyPlaybackEnded=t.sendNotifyPlaybackStarted=void 0;const i=n(913),s=n(473);function l(e,t){if(e.useDiscordNotification&&e.discordWebhookUrl.length>0&&e.discordWebhookUrl.startsWith("https://discord.com/api/webhooks/")){(0,s.log)("Notify/Discord",s.Level.INFO,"Sending notification to discord.");const n=new XMLHttpRequest;n.open("POST",e.discordWebhookUrl),n.setRequestHeader("Content-Type","application/json"),n.addEventListener("readystatechange",(e=>{4==n.readyState&&(204==n.status?(0,s.log)("Notify/Discord",s.Level.INFO,"Successfully sent notification to discord."):400==n.status&&((0,s.log)("Notify/Discord",s.Level.WARN,"Failed to sent notification to discord."),(0,s.log)("Notify/Discord",s.Level.WARN,n.responseText)))})),t=t.replace("%mention%",e.discordMention),n.send(JSON.stringify({username:"N予備校",avatar_url:"https://www.ryuuta0217.com/nnn.ed.nico.png",content:t}))}}function a(e,t,n){if(e.useDesktopNotification){const e=new Notification(t,{body:n,icon:"https://www.nnn.ed.nico/favicon.ico"});e.addEventListener("click",(()=>{chrome.tabs.query({active:!0,currentWindow:!0},(e=>{if(e&&e.length>0){const t=e[0].id;void 0!==t&&chrome.tabs.update(t,{active:!0})}}))})),setTimeout(e.close.bind(e),3e3)}}t.sendNotifyPlaybackStarted=function(e){return o(this,void 0,void 0,(function*(){if(null!=e&&e.isMovie){const t=yield(0,i.getConfig)();t.notifyVideoStateChange&&((0,s.log)("Notify",s.Level.INFO,"Notifying video playback started."),l(t,t.discordPlaybackStartedMessage.replace("%title%",e.title)),a(t,t.desktopPlaybackStarted,e.title),(0,s.log)("Notify",s.Level.INFO,"Successfully sent video playback started notify."))}}))},t.sendNotifyPlaybackEnded=function(e){return o(this,void 0,void 0,(function*(){if(null!=e&&e.isMovie){const t=yield(0,i.getConfig)();t.notifyVideoStateChange&&((0,s.log)("Notify",s.Level.INFO,"Notifying video playback ended"),l(t,t.discordPlaybackEndedMessage.replace("%title%",e.title)),a(t,t.desktopPlaybackEnded,e.title),(0,s.log)("Notify",s.Level.INFO,"Successfully sent video playback ended notify."))}}))},t.sendNotifyTakeTest=function(e){return o(this,void 0,void 0,(function*(){if(null!=e&&(e.isEvaluationTest||e.isEssayTest||e.isEvaluationReport||e.isEssayReport)){const t=yield(0,i.getConfig)();(0,s.log)("Notify",s.Level.INFO,"Notifying take test."),l(t,t.discordTakeTestMessage.replace("%title%",e.title)),a(t,t.desktopTakeTest,e.title),(0,s.log)("Notify",s.Level.INFO,"Successfully sent take test notify.")}}))}},647:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SectionType=void 0,t.SectionType={MOVIE:"movie",SUPPLEMENT:"supplement",EVALUATION_TEST:"evaluation_test",ESSAY_TEST:"essay_test",EVALUATION_REPORT:"evaluation_report",ESSAY_REPORT:"essay_report"}},593:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTime=t.zeroPadding=t.click=void 0,t.click=function(e){const t=document.createEvent("MouseEvent");t.initEvent("click",!0,!0),e.dispatchEvent(t)},t.zeroPadding=function(e,t){return("0".repeat(t)+e).slice(-t)},t.getTime=function(e){let t=[0,0,0];return t[0]=Math.floor(e/3600),t[1]=Math.floor(e%3600/60),t[2]=e%60,t}}},t={};!function n(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}(144)})();