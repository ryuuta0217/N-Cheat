(()=>{"use strict";({144:function(){var e=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function d(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,d)}l((n=n.apply(e,t||[])).next())}))};const t="INFO",i="WARN",n="ERROR";function o(e,o,s){let a=o==t?"[97m":o==i?"[33m":o==n?"[31m":"[90m";console.log(a+"["+new Intl.DateTimeFormat("ja-JP",{timeStyle:"medium"}).format(new Date)+"] ["+e+"] ["+o+"] "+s+"[0m")}function s(s){return e(this,void 0,void 0,(function*(){o("iFrame",t,"Checking iFrame contentWindow...");const m=yield u();if(null!=s.contentWindow){o("iFrame",t,"Successfully get iFrame document."),o("iFrame",t,"Finding VideoPlayer (#video-player)");const f=s.contentWindow.document.getElementById("video-player");null!=f?(o("VideoPlayer",t,"Successfuly found video! "+f),o("VideoPlayer",t,'Regsitering "ended" event to target video!'),f.addEventListener("ended",(s=>{o("VideoPlayer",t,"Playback ended, sending notification..."),function(){e(this,void 0,void 0,(function*(){o("Notify",t,"Notify process started...");const e=yield u();o("Notify",t,"Finding iFrame...");const s=document.getElementById("modal-inner-iframe");if(e.notifyVideoStateChange)if(null!=s&&null!=s.contentWindow){o("Notify",t,"Successfully found iFrame!");const n=s.contentWindow.document.querySelector("div#root>div>div>header>h1>span");let l;null!=n?(l=n.innerText,o("Notify",t,"Successfully found video title!")):(l=e.unknownVideo,o("Notify",i,"Failed to find video title!")),o("Notify",t,"Notifying video playback ended"),e.useDiscordNotification&&a(e.discordPlaybackEndedMessage.replace("%mention%",e.discordMention).replace("%title%",l)),e.useDesktopNotification&&d(e.desktopPlaybackEnded,l),o("Notify",t,"Successfuly sent video playback ended notify.")}else o("Notify",n,"Cannot find iFrame");e.useAutoNext&&setTimeout((()=>{const i=r(!1);if(o("Automation",t,"Finding next video or test..."),null!=i)o("Automation",t,"Next video found! clicking."),c(i.clickTarget),e.notifyVideoStateChange&&(o("Notify",t,"Notifying next video auto started playback."),e.useDiscordNotification&&a(e.discordPlaybackStartedMessage.replace("%mention%",e.discordMention).replace("%title%",i.title)),e.useDesktopNotification&&d(e.desktopPlaybackStarted,i.title),o("Notify",t,"Successfully sent auto playback started notify."));else{o("Autoamtion",t,"Next video not found! Finding test...");const i=function(){const e=l().filter((e=>(e.isEssayTest||e.isEvalutionTest)&&!e.isGateClosed&&!e.isGood&&!e.isOpened));return e.length>0?e[0]:null}();null!=i&&(o("Automation",t,"Next test found!, sending notify."),e.useDiscordNotification&&a(e.discordTakeTestMessage.replace("%mention%",e.discordMention).replace("%title%",null!=i?i.title:e.unknownTest)),e.useDesktopNotification&&d(e.desktopTakeTest,null!=i?i.title:e.unknownTest),o("Automation",t,"Successfully sent next test notify."))}}),e.videoEndedSearchNextDelay)}))}(),o("VideoPlayer",t,"Successfully sent notification!")})),o("VideoPlayer",t,'Successfully registered "ended" event to target video!'),m.useAutoPauseUnblock&&(o("VideoPlayer",t,'Registering "pause" event to target video!'),f.addEventListener("pause",(e=>{f.currentTime!=f.duration&&(o("VideoPlayer",t,"\nDamn, that trashy high school just paused the video!\nI'll never forgive you! I'm gonna resume playback!\nLMAO."),e.preventDefault(),e.stopImmediatePropagation(),f.play())})),o("VideoPlayer",t,'Successfully registered "pause" event to target video!')),m.useSeekUnblock&&(o("VideoPlayer",t,'Registering "seeking" event to target video!'),f.addEventListener("seeking",(e=>{e.preventDefault(),e.stopImmediatePropagation()})),o("VideoPlayer",t,'Successfuly registered "seeking" event to target video!'),o("VideoPlayer",t,'Registering "seeked" event to target video!'),f.addEventListener("seeked",(e=>{e.preventDefault(),e.stopImmediatePropagation()})),o("VideoPlayer",t,'Successfully registered "seeked" event to target video!'))):o("VideoPlayer",n,"Failed to find video!")}else o("iFrame",n,"Failed to get iFrame document!")}))}function a(n){return e(this,void 0,void 0,(function*(){const e=yield u();if(e.useDiscordNotification&&e.discordWebhookUrl.length>0&&e.discordWebhookUrl.startsWith("https://discord.com/api/webhooks/")){o("Discord",t,"Sending notification to discord.");const s=new XMLHttpRequest;s.open("POST",e.discordWebhookUrl),s.setRequestHeader("Content-Type","application/json"),s.addEventListener("readystatechange",(e=>{4==s.readyState&&(204==s.status?o("Discord",t,"Successfully sent notification to discord."):400==s.status&&(o("Discord",i,"Failed to sent notification to discord."),o("Discord",i,s.responseText)))})),s.send(JSON.stringify({username:"Näºˆå‚™æ ¡",avatar_url:"https://www.nnn.ed.nico/favicon.ico",content:n}))}}))}function d(t,i){return e(this,void 0,void 0,(function*(){if((yield u()).useDesktopNotification){const e=new Notification(t,{body:i,icon:"https://www.nnn.ed.nico/favicon.ico"});setTimeout(e.close.bind(e),5e3)}}))}function l(){const e=document.querySelectorAll("div.l-contents#sections-contents>div.section>div.u-card>ul.u-list>li"),t=[];return e.forEach(((e,i)=>{const n=e.className,o=e.getElementsByTagName("a");let s=-1;if(n.includes("movie")){const t=e.querySelector("a>div.section-optional-info>p.content-amount.movie-length").innerText.split(":");2==t.length?s=60*Number(t[0])+Number(t[1]):3==t.length&&(s=60*Number(t[0])*60+60*Number(t[1])+Number(t[2]))}let a={title:e.querySelector("a>div.section-main-info>div>p>span.title").innerText,isGood:n.includes("good"),isMovie:n.includes("movie"),isSupplement:n.includes("supplement"),isEvalutionTest:n.includes("evaluation-test"),isEssayTest:n.includes("essay-test"),isOpened:o.length>0&&o[0].className.includes("is-selected"),isGateClosed:o.length>0&&o[0].className.includes("is-gate-closed"),movieTimeSeconds:s,element:e,clickTarget:o.length>0?o[0]:null};t[i]=a})),t}function r(e){const t=l().filter((t=>t.isMovie&&!t.isOpened&&!t.isGood&&!t.isGateClosed&&(e&&t.isSupplement||!t.isSupplement)));return t.length>0?t[0]:null}function c(e){const t=document.createEvent("MouseEvent");t.initEvent("click",!0,!0),e.dispatchEvent(t)}function u(){return e(this,void 0,void 0,(function*(){return yield chrome.storage.sync.get(null)}))}"denied"!=window.Notification.permission&&"default"!=window.Notification.permission||window.Notification.requestPermission().then((()=>{"granted"==window.Notification.permission?o("Permission",t,"Desktop Notification Permission is now accepted."):o("Permission",i,"Desktop Notification Permission is not accepted, desktop notifications will be not sent to you.")})),document.getElementById("modal-inner-iframe")instanceof HTMLIFrameElement?o("main",n,"iFrame already appended, please reload page and execute this script before start playback."):(new MutationObserver((()=>{o("MutationObserver",t,"DOM change detected, registering 'load' event to iFrame (#modal-inner-iframe)!");const e=document.getElementById("modal-inner-iframe");null!=e&&null!=e?(e.addEventListener("load",(i=>{if(o("iFrame",t,"iFrame loaded."),o("iFrame",t,"Checking iFrame contentWindow..."),null!=e.contentWindow){o("iFrame",t,"iFrame contentWindow found!");const i=function(){const e=l().filter((e=>e.isOpened));return e.length>0?e[0]:null}();if(null==i)return;if(i.isEssayTest||i.isEvalutionTest||!i.isMovie)o("iFrame",t,"Opened iFrame is Essay or Evalution test, skipping.");else if(o("iFrame",t,"Finding VideoPlayer..."),e.contentWindow.document.getElementById("video-player")instanceof HTMLMediaElement)o("iFrame",t,"VideoPlayer already loaded, use this."),s(e);else{o("iFrame",t,"VideoPlayer not loaded, use setInterval to try find...");const i=setInterval((()=>{if(null!=e.contentWindow){const n=e.contentWindow.document.getElementById("video-player");null!=n&&null!=n&&(o("iFrame/Timer",t,"VideoPlayer loaded!"),clearInterval(i),s(e))}}),10)}}})),o("MutationObserver",t,"Successfully registered 'load' event to iFrame (#modal-inner-iframe)")):o("MutationObserver",n,"Failed to find iFrame (#modal-inner-iframe)! Event is not registered.")})).observe(document.querySelector('div[data-react-class="App.Modal"'),{childList:!0}),u().then((e=>{if(e.startPlaybackWhenOpenPage){const e=r(!1);null!=e&&(o("main",t,"Auto playback starting."),c(e.clickTarget))}})));const m=l();let f=0,v=0,y=0;m.forEach((e=>{e.isMovie&&!e.isSupplement&&(f+=e.movieTimeSeconds,e.isGood?v+=e.movieTimeSeconds:y+=e.movieTimeSeconds)}));let p=0,g=0,h=0;m.forEach((e=>{e.isMovie&&e.isSupplement&&(p+=e.movieTimeSeconds,e.isGood?h+=e.movieTimeSeconds:g+=e.movieTimeSeconds)}));let N=f+p;Math.floor(N/3600);const k=Math.floor(f/3600),b=Math.floor(p/3600),S=(Math.floor(N%3600/60),Math.floor(f%3600/60)),M=Math.floor(p%3600/60);let w="å¿…ä¿®æ•™æ: "+(k>0?k+"æ™‚é–“":"")+S+"åˆ†"+f%60+"ç§’",F="Nãƒ—ãƒ©ã‚¹æ•™æ: "+(b>0?b+"æ™‚é–“":"")+M+"åˆ†"+p%60+"ç§’";const E=Math.floor(v/3600),T=Math.floor(v%3600/60),P=v%60,D=Math.round(v/f*100),V=Math.floor(y/3600),I=Math.floor(y%3600/60);let W="è¦–è´æ¸ˆã¿å¿…ä¿®æ•™æ: "+(E>0?E+"æ™‚é–“":"")+(T>0?T+"åˆ†":"")+P+"ç§’ ("+D+"%)",O="æœªè¦–è´å¿…ä¿®æ•™æ: "+(V>0?V+"æ™‚é–“":"")+(I>0?I+"åˆ†":"")+y%60+"ç§’";const x=Math.floor(h/3600),A=Math.floor(h%3600/60),L=h%60,C=Math.round(h/p*100),B=Math.floor(g/3600),R=Math.floor(g%3600/60);let q="è¦–è´æ¸ˆã¿Nãƒ—ãƒ©ã‚¹æ•™æ: "+(x>0?x+"æ™‚é–“":"")+(A>0?A+"åˆ†":"")+L+"ç§’ ("+C+"%)",G="æœªè©¦è´Nãƒ—ãƒ©ã‚¹æ•™æ: "+(B>0?B+"æ™‚é–“":"")+(R>0?R+"åˆ†":"")+g%60+"ç§’",H=document.getElementsByClassName("description");void 0===H&&location.reload();let U=document.querySelectorAll("li.movie:not(.supplement)").length,j=(document.getElementsByClassName("movie").length,document.getElementsByClassName("evaluation-test").length);H[0].innerHTML="<div class='u-card'><div class='u-list-header typo-list-title'>ã“ã®å˜å…ƒã®é€²æ—çŠ¶æ³</div><div class='u-card-inner'>[åˆè¨ˆ]<br>"+w+"<br>"+F+"<br><br>[å¿…ä¿®]<br>"+W+"<br>"+O+"<br><br>[Nãƒ—ãƒ©ã‚¹]<br>"+q+"<br>"+G+"<br><br>[æœ¬æ•°]<br>å¿…ä¿®æ•™æå‹•ç”»æ•°: "+U+"æœ¬<br>ç¢ºèªãƒ†ã‚¹ãƒˆã®æ•°: "+j+"å€‹</div></div>"+H[0].innerHTML}})[144]()})();